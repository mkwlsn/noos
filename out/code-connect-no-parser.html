<h1>Writing Code Connect without a parser</h1><p>This is a supplementary feature for handling complex use cases that aren't fully covered by the existing Code Connect APIs (React, HTML, Compose, SwiftUI). While most use cases can be handled by the standard APIs, you may have use cases  when you need:</p><ul><li><strong>Custom Property Transformations</strong>: When you need complex logic to transform component properties beyond simple mapping, like combining multiple properties into a single prop or applying conditional logic</li><li><strong>Cross-Component Communication</strong>: When components need to share data or state that isn't represented in the Figma hierarchy</li><li><strong>Custom Code Organization</strong>: When you need to control exactly how nested components are rendered, like flattening a deep component tree or reorganizing the component hierarchy</li></ul><h2 class="anchor anchorWithStickyNavbar_loeA" id="setup"><a class="hash-link" href="#setup" title="Direct link to heading"></a>Setup</h2><p>To use:</p><ol><li>Add the <code>--include-template-files</code> flag to your Code Connect command:</li></ol><div class="codeBlockContainer_X7hc language-bash theme-code-block"><div class="codeBlockContent_vqWU" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><pre tabindex="0" class="prism-code language-bash codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">figma connect publish --include-template-files</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="2"><li>Make sure your <code>figma.config.json</code> also includes <code>.figma.template.js</code> files:</li></ol><div class="codeBlockContainer_X7hc language-json theme-code-block"><div class="codeBlockContent_vqWU" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><pre tabindex="0" class="prism-code language-json codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token property">"include"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">[</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token string" style="color: rgb(255, 121, 198);">"**/*.figma.template.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">]</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ol start="3"><li>Write your <code>.figma.template.js</code> file. It should follow the below format:</li></ol><div class="codeBlockContainer_X7hc language-javascript theme-code-block"><div class="codeBlockContent_vqWU" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><pre tabindex="0" class="prism-code language-javascript codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token comment" style="color: rgb(98, 114, 164);">// url=https://www.figma.com/file/your-file-id/Component?node-id=123</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> figma </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">require</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">'figma'</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> instance </span><span class="token operator">=</span><span class="token plain"> figma</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token property-access">selectedInstance</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token comment" style="color: rgb(98, 114, 164);">// code using [Template V2 API](/template-v2-api)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_loeA" id="connecting-to-figma-nodes"><a class="hash-link" href="#connecting-to-figma-nodes" title="Direct link to heading"></a>Connecting to Figma Nodes</h2><p>Each file is connected to a specific Figma component through a URL comment at the top of the file. This URL must point to the exact component node you want to template.</p><p>Here's how it works:</p><ol><li>In Figma, right-click on your component and select "Copy link to selection" or copy the URL from the browser</li><li>Create a new <code>.figma.template.js</code> file</li><li>Add the URL as a comment at the top of the file (this is required for Code Connect to know which component to apply to)</li></ol><p>When Code Connect processes your files:</p><ol><li>It reads the URL comment to find the corresponding Figma component</li><li>The component's instance is made available via <code>figma.selectedInstance</code></li><li>You can then access the component's properties, find child layers, and generate code using the <a href="/code-connect-docs/template-v2-api/">Template V2 API</a></li></ol><p>Here's a complete example showing how to use these concepts:</p><div class="codeBlockContainer_X7hc language-javascript theme-code-block"><div class="codeBlockContent_vqWU" style="color: rgb(248, 248, 242); background-color: rgb(40, 42, 54);"><pre tabindex="0" class="prism-code language-javascript codeBlock_wPnj thin-scrollbar"><code class="codeBlockLines_fQUY"><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token comment" style="color: rgb(98, 114, 164);">// url=https://www.figma.com/file/your-file-id/Component?node-id=123</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> figma </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color: rgb(80, 250, 123);">require</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">'figma'</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> instance </span><span class="token operator">=</span><span class="token plain"> figma</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token property-access">selectedInstance</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token comment" style="color: rgb(98, 114, 164);">// Access component properties using the Template V2 API</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> labelText </span><span class="token operator">=</span><span class="token plain"> instance</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token method function property-access" style="color: rgb(80, 250, 123);">getString</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">'Label'</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Gets the value of a text property</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> isDisabled </span><span class="token operator">=</span><span class="token plain"> instance</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token method function property-access" style="color: rgb(80, 250, 123);">getBoolean</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">'Disabled'</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Gets the value of a boolean property</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token comment" style="color: rgb(98, 114, 164);">// Find and access child layers</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> iconInstance </span><span class="token operator">=</span><span class="token plain"> instance</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token method function property-access" style="color: rgb(80, 250, 123);">findInstance</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">'Icon'</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Find a nested icon component</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword" style="color: rgb(189, 147, 249); font-style: italic;">const</span><span class="token plain"> helperText </span><span class="token operator">=</span><span class="token plain"> instance</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token method function property-access" style="color: rgb(80, 250, 123);">findText</span><span class="token punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token string" style="color: rgb(255, 121, 198);">'HelperText'</span><span class="token punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Find a text layer</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain" style="display: inline-block;"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token comment" style="color: rgb(98, 114, 164);">// Export the rendered code and optional metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token keyword module" style="color: rgb(189, 147, 249); font-style: italic;">export</span><span class="token plain"> </span><span class="token keyword module" style="color: rgb(189, 147, 249); font-style: italic;">default</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token literal-property property">example</span><span class="token operator">:</span><span class="token plain"> figma</span><span class="token punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token property-access">code</span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token template-string string" style="color: rgb(255, 121, 198);"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token template-string string" style="color: rgb(255, 121, 198);">    &lt;MyComponent</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token template-string string" style="color: rgb(255, 121, 198);">      label={</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">${</span><span class="token template-string interpolation">labelText</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token template-string string" style="color: rgb(255, 121, 198);">}</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token template-string string" style="color: rgb(255, 121, 198);">      disabled={</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">${</span><span class="token template-string interpolation">isDisabled</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token template-string string" style="color: rgb(255, 121, 198);">}</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token template-string string" style="color: rgb(255, 121, 198);">      icon={</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">${</span><span class="token template-string interpolation">iconInstance</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token template-string interpolation method function property-access" style="color: rgb(80, 250, 123);">executeTemplate</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">(</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">)</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token template-string interpolation property-access">example</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token template-string string" style="color: rgb(255, 121, 198);">}</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token template-string string" style="color: rgb(255, 121, 198);">      helperText={</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">${</span><span class="token template-string interpolation">helperText</span><span class="token template-string interpolation punctuation" style="color: rgb(248, 248, 242);">.</span><span class="token template-string interpolation property-access">textContent</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token template-string string" style="color: rgb(255, 121, 198);">}</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token template-string string" style="color: rgb(255, 121, 198);">    /&gt;</span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token template-string string" style="color: rgb(255, 121, 198);">  </span><span class="token template-string template-punctuation string" style="color: rgb(255, 121, 198);">`</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color: rgb(255, 121, 198);">'my-component'</span><span class="token punctuation" style="color: rgb(248, 248, 242);">,</span><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Optional: Custom identifier for referencing this component</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token literal-property property">metadata</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation" style="color: rgb(248, 248, 242);">{</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">    </span><span class="token literal-property property">nestable</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain">  </span><span class="token comment" style="color: rgb(98, 114, 164);">// Controls how this appears when nested in other components</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain">  </span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><span class="token plain"></span><br></span><span class="token-line" style="color: rgb(248, 248, 242);"><span class="token plain"></span><span class="token punctuation" style="color: rgb(248, 248, 242);">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div>